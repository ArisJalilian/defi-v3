{"version":3,"sources":["pages/Proposals/index.js"],"names":["Header","styled","div","Title","h2","theme","text1","PoolsButton","button","bg2","TradeButton","primary","StyledLink","Link","RowTitle","span","CellText","NewButton","GradientButton","StatusText","Proposals","props","library","useActiveWeb3React","useState","selectedProposal","setSelectedProposal","dispatch","useDispatch","useSelector","state","governance","spaces","governanceLoading","loading","proposals","id","match","params","space","useEffect","Object","keys","length","fetchSpaces","hasOwnProperty","fetchProposals","history","push","transformProposals","a","result","selected","getScores","strategies","network","values","map","proposal","address","scores","fromEntries","entries","transformed","assign","score","reduce","b","formatProposals","transformedProposal","sort","msg","payload","end","rowEvents","onClick","e","row","columns","dataField","text","formatter","cellContent","rowIndex","shorten","name","ts","Date","now","toFixed","start","title","className","responsiveClassName","moment","format","slice","actions","to","isAction","morePadding","xs","marginTop","marginBottom","url","color","width","height","active","wrapperClasses","bordered","classes","bootstrap4","remote","keyField","data","breakpoint","direction","concat","headerIndex"],"mappings":"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","file":"static/js/38.091b729c.chunk.js","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Row, Col } from 'react-bootstrap';\nimport {useDispatch, useSelector} from \"react-redux\";\nimport BootstrapTable from \"react-bootstrap-table-next\";\nimport moment from \"moment\";\nimport styled from \"styled-components\";\n\nimport { ResponsiveCard } from \"../../components/Card\";\nimport {fetchProposals, fetchSpaces} from \"../../state/governance/actions\";\nimport {shorten} from \"../../state/governance/hooks\";\nimport {Link} from \"react-router-dom\";\nimport {formatProposals, getScores} from \"../../lib/utils\";\nimport {useActiveWeb3React} from \"../../hooks\";\nimport Loading from \"../../components/Loading\";\nimport Page from \"../../components/Page\";\nimport './style.scss';\nimport '../../components/UI/Button/style.scss';\nimport ResponsiveTable from \"../../components/ResponsiveTable\";\n\nconst Header = styled.div`\n  padding: 0;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 20px;\n  border: none;\n  background-color: transparent;\n  \n  @media (max-width: 767px) {\n    flex-direction: column;\n    align-items: stretch;\n  }\n`\n\nconst Title = styled.h2`\n  font-size: 1.25rem;\n  font-weight: 700;\n  color: ${({ theme }) => theme.text1};\n  margin: 0;\n  \n  @media (max-width: 767px) {\n    margin-bottom: 30px;\n  }\n`\n\nconst PoolsButton = styled.button`\n  border-radius: 12px;\n  background-color: ${({ theme }) => theme.bg2};\n  padding: 6px 20px;\n  max-height: 40px;\n  min-height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  white-space: nowrap;\n  font-size: 1rem;\n  font-family: inherit;\n  font-weight: 500;\n  border: none;\n  outline: none;\n  text-decoration: none;\n  \n  &:hover,\n  &:focus,\n  &:active {\n      text-decoration: none;\n      outline: none;\n      box-shadow: none;\n  }\n`\n\n\nconst TradeButton =  styled(PoolsButton)`\n  color: ${({ theme }) => theme.primary};\n  width: 100%;\n  \n  &:hover {\n    color: ${({ theme }) => theme.bg2};\n    background-color: ${({ theme }) => theme.primary};\n  }\n`\n\nconst StyledLink = styled(Link)`\n  text-decoration: none;\n  &:hover,\n  &:focus,\n  &:active {\n      text-decoration: none;\n      outline: none;\n      box-shadow: none;\n  }\n`\n\nconst RowTitle = styled.span`\n  font-size: 1rem;\n  font-weight: 400;\n  line-height: 19px;\n  color: ${({ theme }) => theme.text1};\n  \n  @media (max-width: 991px) {\n    font-size: .875rem;\n  }\n`\n\nconst CellText = styled.span`\n  font-weight: 700;\n  font-size: .875rem;\n  color: ${({ theme }) => theme.text1};\n  white-space: nowrap;\n  \n  @media (max-width: 991px) {\n  font-weight: 400;\n  }\n`\n\nconst NewButton = styled(Link)`\n    background-color: rgba(135, 220, 225, 0.12);\n    height: 56px;\n    padding: 6px 20px;\n    border-radius: 18px;\n    color: ${({ theme }) => theme.primary};\n    display: flex;\n    align-items: center;\n    transition: 0.3s ease all;\n    justify-content: center;\n   \n    :hover,\n    :focus, \n    :active{\n        background-color: rgba(135, 220, 225, 1);\n        color: ${({ theme }) => theme.text1};      \n        text-decoration: none;\n        outline: none;\n    }\n`\n\nconst GradientButton = styled(Link)`\n    height: 56px;\n    padding: 6px 20px;\n    border-radius: 18px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    margin-bottom: 20px;\n   \n    :hover,\n    :focus, \n    :active{ \n        text-decoration: none;\n        outline: none;\n    }\n`\n\nconst StatusText = styled.span`\n  \n  @media (max-width: 991px) {\n    font-size: .875rem;\n  }\n`\n\nconst Proposals = (props) => {\n    const { library } = useActiveWeb3React();\n    const [selectedProposal, setSelectedProposal] = useState({})\n    const dispatch = useDispatch();\n    const {spaces, loading: governanceLoading, proposals} = useSelector(state => state.governance);\n\n    let id = props.match.params.space;\n    let space = spaces[id];\n\n    useEffect(() => {\n        if(Object.keys(spaces).length === 0) {\n            dispatch(fetchSpaces());\n        } else {\n            if(spaces.hasOwnProperty(id)) {\n                dispatch(fetchProposals(id));\n            } else {\n                props.history.push('/tools/governance');\n            }\n        }\n    }, [spaces, id, props.history, dispatch])\n\n    const transformProposals = async (proposals, id) => {\n        if(proposals.hasOwnProperty(id)) {\n            let result = {};\n            const selected = proposals[id];\n            const scores = await getScores(\n                id,\n                space.strategies,\n                space.network,\n                library,\n                Object.values(selected).map((proposal) => proposal.address)\n            )\n            result = Object.fromEntries(\n                Object.entries(selected).map((proposal) => {\n                    const transformed = [proposal[0], Object.assign({}, proposal[1])]\n                    transformed[1].score = scores.reduce(\n                        (a, b) => a + (b[transformed[1].address] || 0),\n                        0\n                    );\n                    return [transformed[0], transformed[1]];\n                })\n            );\n\n            result = formatProposals(result);\n            const transformedProposal = Object.fromEntries(\n                Object.entries(result)\n                    .sort((a, b) => b[1].msg.payload.end - a[1].msg.payload.end, 0)\n            );\n            setSelectedProposal(transformedProposal);\n        } else {\n            setSelectedProposal({})\n        }\n    }\n\n    useEffect(() => {\n        transformProposals(proposals, id)\n    }, [proposals, id]);\n\n    const rowEvents = {\n        onClick: (e, row) => {\n            props.history.push(`/tools/governance/${id}/proposal/${row[0]}`);\n        }\n    }\n\n    const columns = [\n        {\n            dataField: \"asset\",\n            text: \"Description\",\n            formatter: (cellContent, row, rowIndex) => (\n                <RowTitle>{shorten(row[1].msg.payload.name, 'name')}</RowTitle>\n            ),\n        },\n        {\n            dataField: \"status\",\n            text: \"Status\",\n            formatter(cellContent, row) {\n                const ts = (Date.now() / 1e3).toFixed();\n                const { start, end } = row[1].msg.payload;\n                let state = ts > end ? {title: 'Closed', className: 'label-light-danger', responsiveClassName: 'text-danger'} : ts > start ? {title: 'Active', className: 'label-light-success', responsiveClassName: 'text-success'} : {title: 'Pending', className: 'label-light-info', responsiveClassName: 'text-info'};\n                return (\n                    <>\n                        <span className={`label ${state.className} label-lg d-none d-lg-flex w-100 label-inline py-3`}>\n                            {state.title}\n                        </span>\n                        <StatusText className={`d-flex d-lg-none ${state.responsiveClassName}`}>\n                            {state.title}\n                        </StatusText>\n                    </>\n                )\n            }\n        },\n        {\n            dataField: \"start\",\n            text: \"Start Date\",\n            formatter(cellContent, row) {\n                return (\n                    <CellText>\n                        {moment(row[1].msg.payload.start * 1e3).format('YYYY/MM/DD HH:mm')}\n                    </CellText>\n                )\n            }\n        },\n        {\n            dataField: \"end\",\n            text: \"End Date\",\n            formatter(cellContent, row) {\n                return (\n                    <CellText>\n                        {moment(row[1].msg.payload.end * 1e3).format('YYYY/MM/DD HH:mm')}\n                    </CellText>\n                )\n            }\n        },\n        {\n            dataField: \"author\",\n            text: \"Author\",\n            formatter(cellContent, row) {\n                return (\n                    <CellText>\n                        {row[1].address.slice(0, 6)}...{row[1].address.slice(-4)}\n                    </CellText>\n                )\n            }\n        },\n\n    ]\n\n    const actions = {\n        dataField: \"actions\",\n        text: \"Actions\",\n        formatter(cellContent, row) {\n            return (\n                <div className=\"d-flex flex-column align-items-stretch align-items-lg-center justify-content-center w-100\">\n                    <StyledLink to={`/tools/governance/${id}/proposal/${row[0]}`}>\n                        <TradeButton>\n                            View More\n                        </TradeButton>\n                    </StyledLink>\n                </div>\n            )\n        },\n        isAction: true\n    }\n\n\n    return (\n        <Page title={'Governance'} morePadding>\n            <Row>\n                <Col xs={12}>\n                    <ResponsiveCard marginTop={-30} marginBottom={0}>\n                        <Header >\n                            <Title className=\"card-title\">Proposals</Title>\n                            <NewButton to={`${props.match.url}/create`} className=\"bg-light-primary d-none d-md-flex\">Create New</NewButton>\n                            <GradientButton to={`${props.match.url}/create`} className=\" btn btn-primary btn-gradient-primary d-flex d-md-none\">Create New</GradientButton>\n                        </Header>\n                        <div>\n                            {governanceLoading ? (\n                                <div className=\"d-flex align-items-center justify-content-center py-5 w-100\">\n                                    <Loading color={'primary'} width={40} height={40} active id={'proposals'}/>\n                                </div>\n                            ) : (\n                                <>\n                                    <BootstrapTable\n                                        wrapperClasses=\"table-responsive d-none d-lg-block\"\n                                        bordered={false}\n                                        classes={`table table-head-custom table-borderless table-vertical-center overflow-hidden table-hover proposals__table`}\n                                        bootstrap4\n                                        remote\n                                        keyField=\"id\"\n                                        columns={columns}\n                                        data={Object.entries(selectedProposal)}\n                                        rowEvents={rowEvents}\n                                    >\n                                    </BootstrapTable>\n                                    <ResponsiveTable breakpoint={'lg'} direction={'rtl'} columns={columns.concat(actions)} data={Object.entries(selectedProposal)} headerIndex={0}/>\n                                </>\n                            )}\n                        </div>\n                    </ResponsiveCard>\n                </Col>\n            </Row>\n        </Page>\n    )\n}\n\nexport default Proposals;\n"],"sourceRoot":""}