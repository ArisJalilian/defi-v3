{"version":3,"sources":["pages/Proposals/index.js"],"names":["Header","styled","div","Title","h2","theme","text1","PoolsButton","button","bg2","TradeButton","primary","StyledLink","Link","RowTitle","span","CellText","NewButton","GradientButton","StatusText","Proposals","props","library","useActiveWeb3React","useState","selectedProposal","setSelectedProposal","dispatch","useDispatch","t","useTranslation","useSelector","state","governance","spaces","governanceLoading","loading","proposals","id","match","params","space","useEffect","Object","keys","length","fetchSpaces","hasOwnProperty","fetchProposals","history","push","transformProposals","a","result","selected","getScores","strategies","network","values","map","proposal","address","scores","fromEntries","entries","transformed","assign","score","reduce","b","formatProposals","transformedProposal","sort","msg","payload","end","rowEvents","onClick","e","row","columns","dataField","text","formatter","cellContent","rowIndex","shorten","name","ts","Date","now","toFixed","start","title","className","responsiveClassName","moment","format","slice","actions","to","isAction","morePadding","xs","marginTop","marginBottom","url","color","width","height","active","wrapperClasses","bordered","classes","bootstrap4","remote","keyField","data","breakpoint","direction","concat","headerIndex"],"mappings":"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","file":"static/js/40.63b7950d.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Row, Col } from \"react-bootstrap\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport BootstrapTable from \"react-bootstrap-table-next\";\nimport moment from \"moment\";\nimport styled from \"styled-components\";\n\nimport { ResponsiveCard } from \"../../components/Card\";\nimport { fetchProposals, fetchSpaces } from \"../../state/governance/actions\";\nimport { shorten } from \"../../state/governance/hooks\";\nimport { Link } from \"react-router-dom\";\nimport { formatProposals, getScores } from \"../../lib/utils\";\nimport { useActiveWeb3React } from \"../../hooks\";\nimport Loading from \"../../components/Loading\";\nimport Page from \"../../components/Page\";\nimport \"./style.scss\";\nimport \"../../components/UI/Button/style.scss\";\nimport ResponsiveTable from \"../../components/ResponsiveTable\";\nimport { useTranslation } from \"react-i18next\";\n\nconst Header = styled.div`\n\tpadding: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tmargin-bottom: 20px;\n\tborder: none;\n\tbackground-color: transparent;\n\n\t@media (max-width: 767px) {\n\t\tflex-direction: column;\n\t\talign-items: stretch;\n\t}\n`;\n\nconst Title = styled.h2`\n\tfont-size: 1.25rem;\n\tfont-weight: 700;\n\tcolor: ${({ theme }) => theme.text1};\n\tmargin: 0;\n\n\t@media (max-width: 767px) {\n\t\tmargin-bottom: 30px;\n\t}\n`;\n\nconst PoolsButton = styled.button`\n\tborder-radius: 12px;\n\tbackground-color: ${({ theme }) => theme.bg2};\n\tpadding: 6px 20px;\n\tmax-height: 40px;\n\tmin-height: 40px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\twhite-space: nowrap;\n\tfont-size: 1rem;\n\tfont-family: inherit;\n\tfont-weight: 500;\n\tborder: none;\n\toutline: none;\n\ttext-decoration: none;\n\n\t&:hover,\n\t&:focus,\n\t&:active {\n\t\ttext-decoration: none;\n\t\toutline: none;\n\t\tbox-shadow: none;\n\t}\n`;\n\nconst TradeButton = styled(PoolsButton)`\n\tcolor: ${({ theme }) => theme.primary};\n\twidth: 100%;\n\n\t&:hover {\n\t\tcolor: ${({ theme }) => theme.bg2};\n\t\tbackground-color: ${({ theme }) => theme.primary};\n\t}\n`;\n\nconst StyledLink = styled(Link)`\n\ttext-decoration: none;\n\t&:hover,\n\t&:focus,\n\t&:active {\n\t\ttext-decoration: none;\n\t\toutline: none;\n\t\tbox-shadow: none;\n\t}\n`;\n\nconst RowTitle = styled.span`\n\tfont-size: 1rem;\n\tfont-weight: 400;\n\tline-height: 19px;\n\tcolor: ${({ theme }) => theme.text1};\n\n\t@media (max-width: 991px) {\n\t\tfont-size: 0.875rem;\n\t}\n`;\n\nconst CellText = styled.span`\n\tfont-weight: 700;\n\tfont-size: 0.875rem;\n\tcolor: ${({ theme }) => theme.text1};\n\twhite-space: nowrap;\n\n\t@media (max-width: 991px) {\n\t\tfont-weight: 400;\n\t}\n`;\n\nconst NewButton = styled(Link)`\n\tbackground-color: rgba(135, 220, 225, 0.12);\n\theight: 56px;\n\tpadding: 6px 20px;\n\tborder-radius: 18px;\n\tcolor: ${({ theme }) => theme.primary};\n\tdisplay: flex;\n\talign-items: center;\n\ttransition: 0.3s ease all;\n\tjustify-content: center;\n\n\t:hover,\n\t:focus,\n\t:active {\n\t\tbackground-color: rgba(135, 220, 225, 1);\n\t\tcolor: ${({ theme }) => theme.text1};\n\t\ttext-decoration: none;\n\t\toutline: none;\n\t}\n`;\n\nconst GradientButton = styled(Link)`\n\theight: 56px;\n\tpadding: 6px 20px;\n\tborder-radius: 18px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tmargin-bottom: 20px;\n\n\t:hover,\n\t:focus,\n\t:active {\n\t\ttext-decoration: none;\n\t\toutline: none;\n\t}\n`;\n\nconst StatusText = styled.span`\n\t@media (max-width: 991px) {\n\t\tfont-size: 0.875rem;\n\t}\n`;\n\nconst Proposals = (props) => {\n\tconst { library } = useActiveWeb3React();\n\tconst [selectedProposal, setSelectedProposal] = useState({});\n\tconst dispatch = useDispatch();\n\tconst { t } = useTranslation();\n\tconst { spaces, loading: governanceLoading, proposals } = useSelector((state) => state.governance);\n\n\tlet id = props.match.params.space;\n\tlet space = spaces[id];\n\n\tuseEffect(() => {\n\t\tif (Object.keys(spaces).length === 0) {\n\t\t\tdispatch(fetchSpaces());\n\t\t} else {\n\t\t\tif (spaces.hasOwnProperty(id)) {\n\t\t\t\tdispatch(fetchProposals(id));\n\t\t\t} else {\n\t\t\t\tprops.history.push(\"/tools/governance\");\n\t\t\t}\n\t\t}\n\t}, [spaces, id, props.history, dispatch]);\n\n\tconst transformProposals = async (proposals, id) => {\n\t\tif (proposals.hasOwnProperty(id)) {\n\t\t\tlet result = {};\n\t\t\tconst selected = proposals[id];\n\t\t\tconst scores = await getScores(\n\t\t\t\tid,\n\t\t\t\tspace.strategies,\n\t\t\t\tspace.network,\n\t\t\t\tlibrary,\n\t\t\t\tObject.values(selected).map((proposal) => proposal.address)\n\t\t\t);\n\t\t\tresult = Object.fromEntries(\n\t\t\t\tObject.entries(selected).map((proposal) => {\n\t\t\t\t\tconst transformed = [proposal[0], Object.assign({}, proposal[1])];\n\t\t\t\t\ttransformed[1].score = scores.reduce((a, b) => a + (b[transformed[1].address] || 0), 0);\n\t\t\t\t\treturn [transformed[0], transformed[1]];\n\t\t\t\t})\n\t\t\t);\n\n\t\t\tresult = formatProposals(result);\n\t\t\tconst transformedProposal = Object.fromEntries(\n\t\t\t\tObject.entries(result).sort((a, b) => b[1].msg.payload.end - a[1].msg.payload.end, 0)\n\t\t\t);\n\t\t\tsetSelectedProposal(transformedProposal);\n\t\t} else {\n\t\t\tsetSelectedProposal({});\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\ttransformProposals(proposals, id);\n\t}, [proposals, id]);\n\n\tconst rowEvents = {\n\t\tonClick: (e, row) => {\n\t\t\tprops.history.push(`/tools/governance/${id}/proposal/${row[0]}`);\n\t\t},\n\t};\n\n\tconst columns = [\n\t\t{\n\t\t\tdataField: \"asset\",\n\t\t\ttext: t(\"description\"),\n\t\t\tformatter: (cellContent, row, rowIndex) => <RowTitle>{shorten(row[1].msg.payload.name, \"name\")}</RowTitle>,\n\t\t},\n\t\t{\n\t\t\tdataField: \"status\",\n\t\t\ttext: t(\"status\"),\n\t\t\tformatter(cellContent, row) {\n\t\t\t\tconst ts = (Date.now() / 1e3).toFixed();\n\t\t\t\tconst { start, end } = row[1].msg.payload;\n\t\t\t\tlet state =\n\t\t\t\t\tts > end\n\t\t\t\t\t\t? { title: \"Closed\", className: \"label-light-danger\", responsiveClassName: \"text-danger\" }\n\t\t\t\t\t\t: ts > start\n\t\t\t\t\t\t? { title: \"Active\", className: \"label-light-success\", responsiveClassName: \"text-success\" }\n\t\t\t\t\t\t: { title: \"Pending\", className: \"label-light-info\", responsiveClassName: \"text-info\" };\n\t\t\t\treturn (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<span className={`label ${state.className} label-lg d-none d-lg-flex w-100 label-inline py-3`}>\n\t\t\t\t\t\t\t{state.title}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<StatusText className={`d-flex d-lg-none ${state.responsiveClassName}`}>\n\t\t\t\t\t\t\t{state.title}\n\t\t\t\t\t\t</StatusText>\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tdataField: \"start\",\n\t\t\ttext: t(\"startDate\"),\n\t\t\tformatter(cellContent, row) {\n\t\t\t\treturn <CellText>{moment(row[1].msg.payload.start * 1e3).format(\"YYYY/MM/DD HH:mm\")}</CellText>;\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tdataField: \"end\",\n\t\t\ttext: t(\"endDate\"),\n\t\t\tformatter(cellContent, row) {\n\t\t\t\treturn <CellText>{moment(row[1].msg.payload.end * 1e3).format(\"YYYY/MM/DD HH:mm\")}</CellText>;\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tdataField: \"author\",\n\t\t\ttext: t(\"author\"),\n\t\t\tformatter(cellContent, row) {\n\t\t\t\treturn (\n\t\t\t\t\t<CellText>\n\t\t\t\t\t\t{row[1].address.slice(0, 6)}...{row[1].address.slice(-4)}\n\t\t\t\t\t</CellText>\n\t\t\t\t);\n\t\t\t},\n\t\t},\n\t];\n\n\tconst actions = {\n\t\tdataField: \"actions\",\n\t\ttext: t(\"table.actions\"),\n\t\tformatter(cellContent, row) {\n\t\t\treturn (\n\t\t\t\t<div className=\"d-flex flex-column align-items-stretch align-items-lg-center justify-content-center w-100\">\n\t\t\t\t\t<StyledLink to={`/tools/governance/${id}/proposal/${row[0]}`}>\n\t\t\t\t\t\t<TradeButton>{t(\"viewMore\")}</TradeButton>\n\t\t\t\t\t</StyledLink>\n\t\t\t\t</div>\n\t\t\t);\n\t\t},\n\t\tisAction: true,\n\t};\n\n\treturn (\n\t\t<Page title={t(\"governance.title\")} morePadding>\n\t\t\t<Row>\n\t\t\t\t<Col xs={12}>\n\t\t\t\t\t<ResponsiveCard marginTop={-30} marginBottom={0}>\n\t\t\t\t\t\t<Header>\n\t\t\t\t\t\t\t<Title className=\"card-title\">{t(\"governance.proposals\")}</Title>\n\t\t\t\t\t\t\t<NewButton to={`${props.match.url}/create`} className=\"bg-light-primary d-none d-md-flex\">\n\t\t\t\t\t\t\t\t{t(\"createNew\")}\n\t\t\t\t\t\t\t</NewButton>\n\t\t\t\t\t\t\t<GradientButton\n\t\t\t\t\t\t\t\tto={`${props.match.url}/create`}\n\t\t\t\t\t\t\t\tclassName=\" btn btn-primary btn-gradient-primary d-flex d-md-none\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{t(\"createNew\")}\n\t\t\t\t\t\t\t</GradientButton>\n\t\t\t\t\t\t</Header>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t{governanceLoading ? (\n\t\t\t\t\t\t\t\t<div className=\"d-flex align-items-center justify-content-center py-5 w-100\">\n\t\t\t\t\t\t\t\t\t<Loading color={\"primary\"} width={40} height={40} active id={\"proposals\"} />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<BootstrapTable\n\t\t\t\t\t\t\t\t\t\twrapperClasses=\"table-responsive d-none d-lg-block\"\n\t\t\t\t\t\t\t\t\t\tbordered={false}\n\t\t\t\t\t\t\t\t\t\tclasses={`table table-head-custom table-borderless table-vertical-center overflow-hidden table-hover proposals__table`}\n\t\t\t\t\t\t\t\t\t\tbootstrap4\n\t\t\t\t\t\t\t\t\t\tremote\n\t\t\t\t\t\t\t\t\t\tkeyField=\"id\"\n\t\t\t\t\t\t\t\t\t\tcolumns={columns}\n\t\t\t\t\t\t\t\t\t\tdata={Object.entries(selectedProposal)}\n\t\t\t\t\t\t\t\t\t\trowEvents={rowEvents}\n\t\t\t\t\t\t\t\t\t></BootstrapTable>\n\t\t\t\t\t\t\t\t\t<ResponsiveTable\n\t\t\t\t\t\t\t\t\t\tbreakpoint={\"lg\"}\n\t\t\t\t\t\t\t\t\t\tdirection={\"rtl\"}\n\t\t\t\t\t\t\t\t\t\tcolumns={columns.concat(actions)}\n\t\t\t\t\t\t\t\t\t\tdata={Object.entries(selectedProposal)}\n\t\t\t\t\t\t\t\t\t\theaderIndex={0}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</ResponsiveCard>\n\t\t\t\t</Col>\n\t\t\t</Row>\n\t\t</Page>\n\t);\n};\n\nexport default Proposals;\n"],"sourceRoot":""}